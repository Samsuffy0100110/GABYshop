<div class="container">
	<div class="row">
		<h2 class="mt-5 mb-5 text-center">Les derniers Produits</h2>
		{% for product in products %}
			<div class="col-lg-3 col-6 mb-2 d-flex justify-content-center">
				<a href="{{ path('product_show', { parentCategory: product.category.parent.slug, category: product.category.slug, product: product.slug }) }}">
					<div class="card product-card shadow">
						<img src="{{ ('/images/products/' ~ product.image0)|imagine_filter('latest_products') }}" class="w-100 card-img-top product-image" alt="{{ product.name }}">
						<div class="middle">
							<a href="{{ path('product_show', { parentCategory: product.category.parent.slug, category: product.category.slug, product: product.slug }) }}" class="product-text nav-link rounded btn btn-outline-light fw-bold">Voir</a>
						</div>
					</a>
					<div class="card-body">
						<h5 class="card-title">{{ product.name }}</h5>
						<p class="card-text">{{ product.summary|u.truncate(50, '...', false) }}</p>
						{% set offers = product.offers|filter(o => o.isActive == true)|filter(o => date(o.startedAT) < date() and date(o.endedAT) > date()) %}
						{% if offers is not empty %}
							{% set offer = offers|first %}
								<p class="card-text fw-bold text-decoration-line-through">{{ product.price }} €</p>
								{# {% for o in offers %}
									{% set offer = o %}
									<span class="badge bg-danger">{{ offer.name }}</span>
									{% if offer.typeReduce == "%" %}
										<p class="card-text fw-bold"> - {{ offer.reduce }} {{ offer.typeReduce }}</p>
										<p class="card-text fw-bold">{{ product.price * (1 - offer.reduce / 100) }} €</p>
									{% else %}
										<p class="card-text fw-bold"> - {{ offer.reduce }} {{ offer.typeReduce }}</p>
										<p class="card-text fw-bold">{{ product.price - offer.reduce }} €</p>
									{% endif %}
								{% endfor %} #}
								{% for key, o in offers %}
									{% if key == 0 %}
										{% set offer = o %}
										<span class="badge bg-danger">{{ offer.name }}</span>
										{% if offer.typeReduce == "%" %}
											<p class="card-text fw-bold"> - {{ offer.reduce }} {{ offer.typeReduce }}</p>
											{# <p class="card-text fw-bold">{{ product.price * (1 - offer.reduce / 100) }} €</p> #}
										{% else %}
											<p class="card-text fw-bold"> - {{ offer.reduce }} {{ offer.typeReduce }}</p>
											{# <p class="card-text fw-bold">{{ product.price - offer.reduce }} €</p> #}
										{% endif %}
									{% endif %}
									{% if key > 0 %}
										{% set offer = o %}
										<span class="badge bg-danger">{{ offer.name }}</span>
										{% if offer.typeReduce == "%" %}
											<p class="card-text fw-bold"> - {{ offer.reduce }} {{ offer.typeReduce }}</p>
											{# <p class="card-text fw-bold">{{ product.price * (1 - offer.reduce / 100) }} €</p> #}
											{# {% set calcul = product.price * (1 - offer.reduce / 100) %} #}
										{% else %}
											<p class="card-text fw-bold"> - {{ offer.reduce }} {{ offer.typeReduce }}</p>
											{# <p class="card-text fw-bold">{{ product.price - offer.reduce }} €</p> #}
											{# {% set calcul = product.price - offer.reduce %} #}
										{% endif %}
									{% endif %}
									{% if key > 0 %}
										{% for key, o in offers %}
												<pre>
													{{ dump(key) }}
												</pre>
										{% endfor %}
									{% endif %}
								{% endfor %}
						{% else %}
							<p class="card-text fw-bold">{{ product.price }} €</p>
						{% endif %}
					</div>
				</div>
			</div>
		{% endfor %}
	</div>
</div>
