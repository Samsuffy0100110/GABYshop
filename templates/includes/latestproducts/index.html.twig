<div class="container">
	<div class="row">
		<h2 class="mt-5 mb-5 text-center">Les derniers Produits</h2>
		{% for product in products %}
			<div class="col-lg-3 col-6 mb-2 d-flex justify-content-center">
				<a href="{{ path('product_show', { parentCategory: product.category.parent.slug, category: product.category.slug, product: product.slug }) }}">
					<div class="card product-card shadow">
						<img src="{{ ('/images/products/' ~ product.image0)|imagine_filter('latest_products') }}" class="w-100 card-img-top product-image" alt="{{ product.name }}">
						<div class="middle">
							<a href="{{ path('product_show', { parentCategory: product.category.parent.slug, category: product.category.slug, product: product.slug }) }}" class="product-text nav-link rounded btn btn-outline-light fw-bold">Voir</a>
						</div>
					</a>
					<div class="card-body">
						<h5 class="card-title">{{ product.name }}</h5>
						<p class="card-text">{{ product.summary|u.truncate(50, '...', false) }}</p>
						{% set offers = product.offers|filter(o => o.isActive == true)|filter(o => date(o.startedAT) < date() and date(o.endedAT) > date()) %}
						{% for offer in offers %}
							{% if loop.index0 == 0 %}
								<p class="card-text fw-bold text-decoration-line-through">{{ product.price }}
									€</p>
							{% endif %}
						{% endfor %}
						{% for offer in offers %}
							{% if offer.typeReduce == "percent" %}
								<span class="badge bg-danger">{{ offer.name }}</span>
								<p class="card-text fw-bold">
									-
									{{ offer.reduce }}
									%</p>
							{% endif %}
							{% if offer.typeReduce == "euro" %}
								<span class="badge bg-danger">{{ offer.name }}</span>
								<p class="card-text fw-bold">
									-
									{{ offer.reduce }}
									€</p>
							{% endif %}
						{% else %}
							<p class="card-text fw-bold">{{ product.price }}
								€</p>
						{% endfor %}
						{% if offers| length > 0 %}
							{% set number = 0 %}
							{% set reduce = 0 %}
							{% set total = 0 %}
							{% for offer in offers %}
								{% if offer.typeReduce == "percent" %}
									{% set number = product.price * offer.reduce / 100 %}
									{% set reduce = reduce + number %}
									{% set total = product.price - reduce %}
								{% endif %}
								{% if offer.typeReduce == "euro" %}
									{% set number = offer.reduce %}
									{% set reduce = reduce + number %}
									{% set total = product.price - reduce %}
								{% endif %}
							{% endfor %}
							<p class="card-text fw-bold">{{ total }}
								€</p>
						{% endif %}
					</div>
				</div>
			</div>
		{% endfor %}
	</div>
</div>
