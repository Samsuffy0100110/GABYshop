{% extends 'base.html.twig' %}

{% block title %}
	Ma commande |
	{{ parent() }}
{% endblock %}

{% block body %}
	<div class="container">
		<h1>Commande n°{{ order.reference }}</h1>
		<a href="{{ path('account_orders') }}">Retour</a>
		<hr>
		<strong>Statut de la commande :
		</strong>
		{% if order.state == 0 %}
			En attente de paiement
		{% elseif order.state == 1 %}
			Payée
		{% elseif order.state == 2 %}
			Préparation en cours
		{% elseif order.state == 3 %}
			Livraison en cours
		{% elseif order.state == 4 %}
			Livrée
		{% endif %}<br>
		<strong>Commande passé le :</strong>
		{{ order.createdAt |date('d-m-Y') }}<br>
		<strong>Référence de ma commande :</strong>
		{{ order.reference }}<br>
		<strong>Transporteur choisi :</strong>
		{% for ship in shipping %}
			{{ ship.name }}
		{% endfor %}
		<br>
		<hr>
		<strong>Détails</strong>
		<table class="table mt-4">
			<thead>
				<tr>
					<th scope="col">Produit</th>
					<th scope="col">Quantité</th>
					<th scope="col">Prix unitaire HT</th>
					<th scope="col">Prix unitaire TTC</th>
					<th scope="col">Total</th>
				</tr>
			</thead>
			<tbody>
				<pre>
					{{ dump(order) }}
				</pre>
				{% for custom in order.customs %}
					<pre>
						{{ dump(custom) }}
					</pre>
				{% endfor %}
				{% for product in order.orderDetails %}
					<tr>
						<td>{{ product.product }}</td>
						<td>{{ product.quantity }}</td>
						{% if product.taxe == "TVA 20%" %}
							<td>{{ (product.price * 0.8 / 100)|number_format(2, ',', '.', ' ') }}
								&euro;
							</td>
						{% else %}
							<td>{{ (product.price * 0.9 / 100)|number_format(2, ',', '.', ' ') }}
								&euro;
							</td>
						{% endif %}
						<td>{{ (product.price / 100)|number_format(2, ',', '.', ' ') }}
							&euro;
						</td>
						<td>{{ ((product.total) / 100)|number_format(2, ',', '.', ' ') }}
							&euro;
						</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
		<div class="row">
			<div class="col-lg-10"></div>
			<div class="col-lg-2 bg-light rounded mt-2 mb-5 p-3">
				<div class="text-end">
					<strong>Sous Total HT:</strong>
					{{ ( order.getTotal - (order.getTotal / 100)) / 100 }}
					&euro;
					<hr>
					<strong>Sous-total TTC:
					</strong>
					{{ ((order.getTotal) / 100)|number_format(2, ',', '.', ' ') }}
					&euro;
					<hr>
					<strong>Livraison :
					</strong>
					{% for ship in shipping %}
						{{ ((ship.price))|number_format(2, ',', '.', ' ') }}
					{% endfor %}
					&euro;
					<hr>
					<strong>Total :
					</strong>
					{% for ship in shipping %}
						{{ ((order.getTotal) / 100 + ship.price)|number_format(2, ',', '.', ' ') }}
						&euro;
					{% endfor %}
				</div>
			</div>
		</div>
		<a class="linkNav" href="{{ path('account_order_pdf', { id: order.id }) }}">Télécharger votre facture au format pdf</a>
	</div>
{% endblock %}
